# 企业应用架构模式阅读笔记

## 引言
- 企业应用和电信软件面临的不同挑战
    - 前者是复杂业务导致的复杂数据处理
    - 后者是高可靠性导致的多线程开发
    
- 企业应用开发时的常见约束条件
    - 持久化数据使用周期长
    - 设计大量数据
    - 多人同时访问数据
    - 有大量操作数据的用户界面屏幕
    - 需要与散布在企业周围的其他应用集成
    - 集成中数据 / 概念的不一致性
    
- 企业应用的种类
    - B2C
        - 大量用户    
        - 简单业务逻辑
        - 高可伸缩性
    
    - 租约合同自动处理系统
        - 少量用户
        - 业务复杂        
        - 复杂界面
        - 超长事务
    
    - 开支跟踪系统
        - 用户少
        - 业务简单
        - 需要快速开发
        - 需要高可扩展性（易于为第三方系统集成）
    
- 性能
    - 眼见为实
    - 考量单位
        - 响应时间
        - 响应性（有没有假死）
        - 等待时间（网络延时等非编程可控等待时间）
        - 吞吐率（请求量/时间）
        - 负载
        - 负载敏感度（用户上升时，系统的负载上升速率）
        - 效率（性能/资源）
        - 可伸缩性（增加资源，硬件，对系统的影响）

- 模式
    - 使用时机
    - 意图和概要
    - 运行机制
    - 使用时机
    - 进一步阅读
    - 局限性
    
## 分层
    - 表现层（为外部提供服务的接口）
    - 领域层
    - 数据层（调用外部服务的接口）
    - 下层不依赖于上层

## 组织领域逻辑
- 主要模式
    - 事务脚本（面向过程的开发）
        - 优点：简单，边界明显
        - 缺点：过程内部可能包含了太多逻辑而导致程序复杂度变高
    - 领域模型（面向对象的开发）
        - 优点：容易在原有流程上扩展新的方法（因为所有处理后的结果都保存在了对象（的状态）内部）
        - 缺点：不容易确定对象的状态，因为有太多方法改变了状态
    - 表模块
        - 中间状态
- 选择
    - 复杂度（领域模型对代码复杂度的敏感度最低，但初始工作量最高）
    
## 映射到关系数据库
- 非关系型数据库
    - 缺点：没有通用语言
    - 优点：随取随用

- 关系型数据库
    - 优势：关系型数据库工具多
    - 缺点：需要为ORM映射付出代价
    - 常见映射方式：表 / 行
    
- ORM映射过程中的存
    - 如何保证在内存中的数据能正确的被更新到数据库中（而没有脏读，重复写入？）
    - 工作单元（数据库映射控制器）
    
- ORM映射过程中的取
    - 连接数据库的代价不小，如何以合适的阈值取出数据？
    
- 结构映射模式
    - 表关系（1-1,1-*,*-1,*-*）的映射
    - （实体）继承

- 建立映射

- 数据库连接

## Web表现层
- 服务器脚本
    - 适合解释请求信息

- 服务器页面
    - 适合格式化页面信息
    
- 视图-模型-控制器模式
    - 视图
        - 模板视图：可嵌套编程代码的视图（php，asp），常见于服务端代码
        - 转换视图：如果数据是XML，那使用XMLT 可以帮你快速转换出想要的结果
        - 两步视图：带母板页的视图

    
- 输入控制器模式
    - 在一个模块中，响应http，处理请求 
    - 在两个模块中，响应http，处理请求 

## 并发
- 本质上需要解决的问题
    - （写）更新丢失
    - （读）不一致读
    
- 执行语境（Execution Context）
    - 当前代码执行的环境的边界是什么？时间 / 空间 / 业务

- 隔离与不变性
- 乐观并发控制和悲观并发控制
    - 避免不一致读
    - 死锁

- 事务
    - ACID
    - 事务资源
    - 减少事务提高隔离性
    - 业务事务和系统事务（一个系统中的事务和多个系统中的事务）
    - 离线并发控制的模式
    - 应用服务器并发
    
## 会话状态
- 无状态的价值（服务器可以处理更多请求而不必为每个请求/会话消耗内存）
- 会话状态（在持久化之前（被业务事务处理之前）需要非持久化（驻留内存）的那部分内容）
- 存储会话状态的方法
    - 客户会话状态
    - 服务器会话状态
    - 数据库会话状态

    - 其他需要考虑的（会话迁移，取消会话，系统崩溃）